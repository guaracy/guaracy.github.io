<!DOCTYPE html>
<html lang="pt-BR">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Parser - extraindo dados de páginas &middot;  Cadafalso" />
  
  <meta name="theme-color" content="#ff0000" />
 
  <meta property="og:site_name" content="Cadafalso" />
  <meta property="og:url" content="https://guaracy.github.io/post/parser-extraindo-dados-de-paginas/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:author" content="https://facebook.com/guaracybm" />
  
  <meta property="og:article:published_time" content="2017-02-23T00:00:00Z" />
  
  <meta property="og:article:tag" content="red" />
  
  <meta property="og:article:tag" content="rebol" />
  
  <meta property="og:article:tag" content="er" />
  
  <meta property="og:article:tag" content="expressões regulares" />
  
  <meta property="og:article:tag" content="parser" />
  
  

  <title>
     Parser - extraindo dados de páginas &middot;  Cadafalso
  </title>

  <link rel="stylesheet" href="https://guaracy.github.io/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://guaracy.github.io/css/main.css" />
  <link rel="stylesheet" href="https://guaracy.github.io/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://guaracy.github.io/css/github.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="https://guaracy.github.io/images/favicon.ico" />
  <link rel="apple-touch-icon" href="https://guaracy.github.io/images/apple-touch-icon.png" />
  
</head>
<body>
    <header class="global-header"  style="background-image:url( /images/bg.jpg )">
    <section class="header-text">
      <h1><a href="https://guaracy.github.io/">Cadafalso</a></h1>
      
      <div class="tag-line">
        Apenas mais um blog
      </div>
      
      <div class="sns-links hidden-print">
  
  <a href="mailto:guaracy.bm@gmail.com">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/guaracybm" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  <a href="https://facebook.com/guaracybm" target="_blank">
    <i class="fa fa-facebook"></i>
  </a>
  
  
  <a href="https://github.com/guaracy" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
</div>

      
      <a href="https://guaracy.github.io/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
      
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">Parser - extraindo dados de páginas</h1>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2017-02-23T00:00:00Z">
          Feb 23, 2017
        </time>
      </div>
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://guaracy.github.io//tags/red">#red</a></span>
        
        <span class="post-tag small"><a href="https://guaracy.github.io//tags/rebol">#rebol</a></span>
        
        <span class="post-tag small"><a href="https://guaracy.github.io//tags/er">#er</a></span>
        
        <span class="post-tag small"><a href="https://guaracy.github.io//tags/express%C3%B5es-regulares">#expressões regulares</a></span>
        
        <span class="post-tag small"><a href="https://guaracy.github.io//tags/parser">#parser</a></span>
        
      </div>
    </div>
  </header>
  <section>
    <div class="document">


<p>O <code>parser</code> é a versão de <strong>Rebol</strong> (consequentemente de <a class="reference external" href="http://www.red-lang.org/">Red</a>) para as <a class="reference external" href="https://pt.wikipedia.org/wiki/Express%C3%A3o_regular">expressões regulares</a> (RE). A maior diferença é que o parser de Red é perfeitamente integrado a linguagem, possuindo uma maior verbosidade mas sendo menos criptográfico (YMMV). Não posso deixar de mencionar o <a class="reference external" href="https://en.wikipedia.org/wiki/Icon_(programming_language)#String_scanning">string scanning</a> de Icon já que foi a segunda forma que conheci. Infelizmente o pessoal de Icon resolveu fazer uma nova versão em Go (outra linguagem baseada em Icon) e deixaram de fora esta parte que era uma das mais interessantes da linguagem e passaram a utilizar RE).</p>
<p>O parser de Red nada mais é do que uma DSL <a class="reference external" href="https://github.com/red/red/blob/master/runtime/parse.reds">escrita</a> na própria linguagem.</p>
<p>Basicamente é um ponteiro que percorre um determinado texto seguindo determinadas regras e geralmente utilizado para:</p>
<ul class="simple">
<li>seleção e extração de textos;</li>
<li>validação de textos;</li>
<li>alteração de textos.</li>
</ul>
<!-- TEASER_END -->
<div class="section" id="introducao">
<h1>Introdução</h1>
<p>A estrutura do <cite>parser</cite> é <code>parser entrada regras</code> onde <strong>regras</strong> é um bloco contendo as regras que serão aplicadas na entrada. Antes de nos aventurarmos em alguns exemplos, é necessário conhecer algumas diretivas que podem ser utilizadas nas regras.</p>
<p>1. <strong>to &lt;val&gt;</strong> : Procura por &lt;val&gt; e posiciona o ponteiro no início da ocorrência ou no final da entrada, se não encontrar. <cite>end</cite> indica para posicionar no final do arquivo.</p>
<pre class="literal-block">
red&gt;&gt; parse &quot;111-AAA&quot; [to &quot;-&quot; collect keep to end]
== [&quot;-AAA&quot;]
</pre>
<p>2. <strong>thru &lt;val&gt;</strong> : Procura por &lt;val&gt; e posiciona o ponteiro após a ocorrência</p>
<pre class="literal-block">
red&gt;&gt; parse &quot;111-AAA&quot; [thru &quot;-&quot; collect keep to end]
== [&quot;AAA&quot;]
</pre>
<p>3. <strong>collect</strong> e <strong>keep</strong> : O <cite>collect</cite> indica que deverão ser coletados em um bloco os dados posteriores que forem precedidos por <cite>keep</cite> como pode ser visto nos exemplos acima (note que no exemplo abaixo não estamos trabalhando com texto e sim com um bloco em Red; é a vantagem da integração do <cite>parse</cite>).</p>
<pre class="literal-block">
red&gt;&gt; collect [1 2 keep 3 keep 4 5 keep 6]
== [3 4 6]
</pre>
<p>4. <strong>any</strong>, <strong>some</strong> e <strong>inteiro</strong> : O <cite>any</cite> repete a regra zero ou mais vezes, o <cite>some</cite> uma ou mais vezes e o <cite>inteiro</cite> repete a regra um número especificado de vezes.</p>
<pre class="literal-block">
red&gt;&gt; parse &quot;AA-BBCDEF&quot; [2 &quot;A&quot; some &quot;-&quot; collect keep to end]
== [&quot;BBCDEF&quot;]
red&gt;&gt; parse &quot;AA-BBCDEF&quot; [any &quot;x&quot; collect keep to end]
== [&quot;AA-BBCDEF&quot;]
</pre>
<p>5. <strong>[n] skip</strong> : Avança o ponteiro uma ou mais posições</p>
<pre class="literal-block">
red&gt;&gt; parse &quot;111++222&quot; [to &quot;+&quot; collect keep to end]
== [&quot;++222&quot;]
red&gt;&gt; parse &quot;111++222&quot; [to &quot;+&quot; 2 skip collect keep to end]
== [&quot;222&quot;]
</pre>
<p>6. <strong>copy</strong> &lt;var&gt; : Copia o valor que casar para a variável especificada. Diferente de ERs, não existem variáveis predefinidas como $1, $2, etc..</p>
<pre class="literal-block">
red&gt;&gt; parse &quot;122.444.666&quot; [thru &quot;.&quot; copy v to &quot;.&quot; (print [&quot;2º :&quot; v])]
2º : 444
</pre>
<p>Bem, existem diversas outras diretivas e combinações, mas já é possível brincar com o que foi apresentado aqui.</p>
</div>
<div class="section" id="exemplo-do-aurelio">
<h1>Exemplo do Aurélio</h1>
<p>O <a class="reference external" href="http://aurelio.net">Aurélio</a>, se não é o cara que mais entende de ER, é o que melhor sabe explicar este assunto complexo. Vou pegar a vídeo-aula que ele fez de <a class="reference external" href="http://aurelio.net/blog/2011/05/05/como-extrair-e-formatar-texto-usando-expressoes-regulares/">Como extrair e formatar texto usando Expressões Regulares</a> e adaptá-la para o Red e o parse. Na primeira parte, iremos copiar a página para analisar. Na segunda iremos ler diretamente da página html.</p>
<div class="section" id="primeira-parte">
<h2>Primeira parte</h2>
<p>Para esta parte, como no vídeo acima, iremos copiar (da linha <em>quot</em> até a linha <em>diams</em> e pode ser todas as colunas) os dados <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Character_entity_references_in_HTML">desta</a> tabela da wikipedia e gravar em uma arquivo <tt class="docutils literal">page.txt</tt> no mesmo diretório onde irá rodar o nosso programa em Red.
O arquivo .txt terá o seguinte conteúdo:</p>
<pre class="literal-block">
quot  &quot;      U+0022 (34)     HTML 2.0        HTMLspecial     ISOnum  quotation mark (APL quote)
amp   &amp;      U+0026 (38)     HTML 2.0        HTMLspecial     ISOnum  ampersand
apos  '      U+0027 (39)     XHTML 1.0       HTMLspecial     ISOnum  apostrophe (apostrophe-quote); see below
lt    &lt;      U+003C (60)     HTML 2.0        HTMLspecial     ISOnum  less-than sign
.....
diams ♦      U+2666 (9830)   HTML 4.0        HTMLsymbol      ISOpub  black diamond suit[f]
</pre>
<p>O script para processar o bloco de texto e pegar apenas quatro valores das três primeiras colunas (nome, caractere, valor hexadecimal e valor decimal) fica como abaixo:</p>
<pre class="code red literal-block">
<span class="ln"> 1 </span> <span class="name variable">Red</span> <span class="generic strong">[]</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span> <span class="generic subheading">page:</span> <span class="name function">read</span> <span class="name decorator">%page.txt</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span> <span class="generic subheading">rule:</span> <span class="generic strong">[</span>
<span class="ln"> 6 </span>    <span class="name builtin">any</span> <span class="generic strong">[</span>
<span class="ln"> 7 </span>      <span class="name function">copy</span> <span class="name variable">nome</span> <span class="name function">to</span> <span class="name builtin pseudo">tab</span> <span class="name function">skip</span>
<span class="ln"> 8 </span>      <span class="name function">copy</span> <span class="name variable">caractere</span> <span class="name function">to</span> <span class="name builtin pseudo">tab</span>
<span class="ln"> 9 </span>      <span class="name variable">thru</span> <span class="literal string">&quot;+&quot;</span> <span class="name builtin">any</span> <span class="generic strong">[</span><span class="literal string">&quot;0&quot;</span> <span class="name function">skip</span><span class="generic strong">]</span>
<span class="ln">10 </span>      <span class="name function">copy</span> <span class="name variable">hexadecimal</span> <span class="name function">to</span> <span class="name builtin pseudo">sp</span>
<span class="ln">11 </span>      <span class="name variable">thru</span> <span class="literal string">&quot;(&quot;</span> <span class="name function">copy</span> <span class="name variable">decimal</span> <span class="name function">to</span> <span class="literal string">&quot;)&quot;</span>
<span class="ln">12 </span>      <span class="generic strong">(</span><span class="name builtin">print</span> <span class="generic strong">[</span><span class="name variable">nome</span> <span class="name builtin pseudo">tab</span> <span class="name variable">caractere</span> <span class="name builtin pseudo">tab</span> <span class="name variable">hexadecimal</span> <span class="name builtin pseudo">tab</span> <span class="name variable">decimal</span><span class="generic strong">])</span>
<span class="ln">13 </span>      <span class="name variable">thru</span> <span class="name builtin pseudo">newline</span>
<span class="ln">14 </span>    <span class="generic strong">]</span>
<span class="ln">15 </span> <span class="generic strong">]</span>
<span class="ln">16 </span>
<span class="ln">17 </span> <span class="name exception">parse</span> <span class="name variable">page</span> <span class="name variable">rule</span>
</pre>
<p>Após a execução, teremos uma saída assim (eliminamos as colunas indesejadas e separamos os valores decimal e hexadecimal referente ao caractere):</p>
<pre class="literal-block">
quot    &quot;       22      34
amp     &amp;       26      38
apos    '       27      39
lt      &lt;       3C      60
...
diams   ♦       2666    9830
</pre>
<p>Vejamos o que faz cada linha do script.</p>
<ol class="arabic simple">
<li><strong>Red []</strong> é o cabeçalho necessário para que scripts possam ser executados. No interior do bloco [] podemos ter diversas informações e diretivas.</li>
</ol>
<ol class="arabic simple" start="3">
<li>Lê o conteúdo do arquivo <tt class="docutils literal">page.txt</tt> e o coloca na variável <tt class="docutils literal">page</tt>.</li>
</ol>
<ol class="arabic simple" start="5">
<li>Inicializa o bloco de regras com o nome de <tt class="docutils literal">rule</tt>.</li>
<li>Diz para executar o próximo bloco 0 ou mais vezes.</li>
<li>Copia para a variável <tt class="docutils literal">nome</tt> o conteúdo da entrada até encontrar um <tt class="docutils literal">tab</tt> (tabulação) e avança o ponteiro.</li>
<li>O mesmo da linha 7 para a variável caractere. Eu poderia colocar nomes mais curtos nas variáveis como v1, v2, etc. mas preferi legibilidade (nem sei se poderia chegar a concisão de uma ER).</li>
<li>Posiciona o ponteiro após o &quot;+&quot; e incrementa o ponteiro enquanto achar algum &quot;0&quot; (zero)</li>
<li>Copia o conteúdo para a variável hexadecimal até encontrar um espeço (sp).</li>
<li>Posiciona o ponteiro após o &quot;(&quot; e copia para a variável decimal o conteúdo até o &quot;)&quot;</li>
<li>Imprime uma linha com o conteúdo das variáveis separados por uma tabulação. Aqui também mostra a integração do parse com a linguagem permitindo que as variáveis sejam processadas da forma que o usuário desejar (poderia até converter para klingon).</li>
<li>Posiciona o ponteiro após o final da linha.</li>
<li>Fecha o <tt class="docutils literal">any</tt> aberto na linha 6 e, se ainda tiver algum conteúdo na entrada, o processamento será repetido.</li>
<li>Fecha o bloco da regra aberto na linha 5.</li>
</ol>
<ol class="arabic simple" start="17">
<li>Aplica a regra da linha 5 no texto lido na linha 3.</li>
</ol>
<p>Parece complicado mas é bem simples. Algumas vezes parece complicado e realmente é mais complicado do que parece.</p>
</div>
<div class="section" id="segunda-parte">
<h2>Segunda parte</h2>
<p>O processo anterior pode ser válido em diversos casos. Existem outros como, por exemplo, os valores sofrem alteração no decorrer de um período ou são diversas páginas e fica impraticável copiar e colar cada vez. No próximo artigo veremos um exemplo real e mais complexo. Por enquanto ficaremos com o mesmo para facilitar mas com uma abordagem um pouco diferente.</p>
<p>Iremos ler o conteúdo da página .html, aplicaremos as regras e coletaremos todas as informações para ser trabalhada posteriormente. Para você criar uma regra para extrair dados de um determinado texto ou outro documento, é necessário que você analise antes para poder aplicar os padrões.</p>
<p>Analisando a página da wikipedia, podemos ver que a tabela que queremos é a terceira (existem outra formas de encontrar a tabela). Como pode ser visto no trecho abaixo, após a tag <cite>&lt;table&gt;</cite> temos uma <cite>&lt;th&gt;</cite> que é o cabeçalho e, após, diversas tags <cite>&lt;tr&gt;</cite> que iniciam as linhas com as informações que desejamos. Nossas informações estarão entre <cite>&lt;td&gt;</cite> e <cite>&lt;/td&gt;</cite>. No início já é possível perceber que teremos um problema que deverá ser resolvido posteriormente. Em <cite>amp</cite> a página contém <cite>&amp;amp;</cite> já que o &amp; não pode ser usado isoladamente. Poderemos ter uma função para efetuar essas conversões que não seria tão difícil ou usar um programa externo como <code>cat arquivo | recode html..ascii</code>.</p>
<pre class="code html literal-block">
<span class="punctuation">&lt;</span><span class="name tag">table</span> <span class="name attribute">class</span><span class="operator">=</span><span class="literal string">&quot;wikitable&quot;</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">tr</span> <span class="name attribute">style</span><span class="operator">=</span><span class="literal string">&quot;background: #efefef;&quot;</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">th</span><span class="punctuation">&gt;</span>Name<span class="punctuation">&lt;/</span><span class="name tag">th</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">th</span><span class="punctuation">&gt;</span>Character<span class="punctuation">&lt;/</span><span class="name tag">th</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">th</span><span class="punctuation">&gt;</span>Unicode code point (decimal)<span class="punctuation">&lt;/</span><span class="name tag">th</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">th</span><span class="punctuation">&gt;</span>Standard<span class="punctuation">&lt;/</span><span class="name tag">th</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">th</span><span class="punctuation">&gt;</span>Description<span class="punctuation">&lt;/</span><span class="name tag">th</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;/</span><span class="name tag">tr</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">tr</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>quot<span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>&quot;<span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>U+0022 (34)<span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>XML 1.0<span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>double <span class="punctuation">&lt;</span><span class="name tag">a</span> <span class="name attribute">href</span><span class="operator">=</span><span class="literal string">&quot;/wiki/Quotation_mark&quot;</span> <span class="name attribute">title</span><span class="operator">=</span><span class="literal string">&quot;Quotation mark&quot;</span><span class="punctuation">&gt;</span>quotation mark<span class="punctuation">&lt;/</span><span class="name tag">a</span><span class="punctuation">&gt;&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;/</span><span class="name tag">tr</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">tr</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>amp<span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span><span class="name entity">&amp;amp;</span><span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>U+0026 (38)<span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;</span>XML 1.0<span class="punctuation">&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;</span><span class="name tag">td</span><span class="punctuation">&gt;&lt;</span><span class="name tag">a</span> <span class="name attribute">href</span><span class="operator">=</span><span class="literal string">&quot;/wiki/Ampersand&quot;</span> <span class="name attribute">title</span><span class="operator">=</span><span class="literal string">&quot;Ampersand&quot;</span><span class="punctuation">&gt;</span>ampersand<span class="punctuation">&lt;/</span><span class="name tag">a</span><span class="punctuation">&gt;&lt;/</span><span class="name tag">td</span><span class="punctuation">&gt;</span>
<span class="punctuation">&lt;/</span><span class="name tag">tr</span><span class="punctuation">&gt;</span>
</pre>
<p>O nosso programa poderia ficar assim:</p>
<pre class="code red literal-block">
<span class="ln"> 1 </span><span class="name variable">Red</span> <span class="generic strong">[]</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="generic subheading">page:</span> <span class="name function">read</span> <span class="name decorator">https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span><span class="generic subheading">rule-html:</span> <span class="generic strong">[</span>
<span class="ln"> 6 </span>   <span class="literal number">3</span> <span class="name variable">thru</span> <span class="literal string">&quot;&lt;table&quot;</span>
<span class="ln"> 7 </span>   <span class="name variable">collect</span> <span class="name builtin">any</span> <span class="generic strong">[</span>
<span class="ln"> 8 </span>      <span class="name variable">collect</span> <span class="generic strong">[</span>
<span class="ln"> 9 </span>         <span class="name variable">thru</span> <span class="name variable">&lt;td&gt;</span> <span class="name variable">keep</span> <span class="name function">to</span> <span class="operator">&lt;</span><span class="name attribute">/td&gt;</span> <span class="comment">; name
</span><span class="ln">10 </span><span class="comment"></span>         <span class="name variable">thru</span> <span class="name variable">&lt;td&gt;</span> <span class="name variable">keep</span> <span class="name function">to</span> <span class="operator">&lt;</span><span class="name attribute">/td&gt;</span> <span class="comment">; char
</span><span class="ln">11 </span><span class="comment"></span>         <span class="name variable">thru</span> <span class="literal string">&quot;+&quot;</span> <span class="name builtin">any</span> <span class="generic strong">[</span><span class="literal string">&quot;0&quot;</span> <span class="name function">skip</span><span class="generic strong">]</span> <span class="name variable">keep</span> <span class="name function">to</span> <span class="literal string">&quot; &quot;</span> <span class="comment">; hexa
</span><span class="ln">12 </span><span class="comment"></span>         <span class="name variable">thru</span> <span class="literal string">&quot;(&quot;</span> <span class="name variable">keep</span> <span class="name function">to</span> <span class="literal string">&quot;)&quot;</span> <span class="comment">; decimal
</span><span class="ln">13 </span><span class="comment"></span>         <span class="name variable">thru</span> <span class="name variable">&lt;tr&gt;</span>
<span class="ln">14 </span>      <span class="generic strong">]</span>
<span class="ln">15 </span>   <span class="generic strong">]</span>
<span class="ln">16 </span>   <span class="name function">to</span> <span class="name variable">end</span>
<span class="ln">17 </span><span class="generic strong">]</span>
<span class="ln">18 </span>
<span class="ln">19 </span><span class="generic subheading">tabela:</span> <span class="name exception">parse</span> <span class="name variable">page</span> <span class="name variable">rule-html</span>
</pre>
<p>O programa nem ficou tão diferente do primeiro (o ; indica início de comentário), que analisa apenas um arquivo texto, e ainda podemos ver algumas características da linguagem. A primeira é que foi usado <strong>read</strong> para ler um arquivo texto e uma página https. A segunda, por ser uma linguagem rica em tipos de dados, usamos apenas &lt;td&gt; e não &quot;&lt;td&gt;&quot; para a verificação de conteúdo. Aqui também usamos <strong>collect</strong> pois queremos que todos os dados sejam extraídos e armazenados para futuro processamento.</p>
<p>Inicialmente inicializamos o ponteiro na terceira ocorrência de <cite>&lt;table</cite>, usamos um <cite>collect</cite> para que as informações sejam armazenadas em um bloco e, um segundo <cite>collect</cite> para que cada linha tenha seu próprio bloco.  O resultado após rodar o programa é que tabela conterá algo assim:</p>
<pre class="literal-block">
[[&quot;quot&quot; #&quot;^&quot;&quot; &quot;22&quot; &quot;34&quot;] [&quot;amp&quot; &quot;&amp;amp;&quot; &quot;26&quot; &quot;38&quot;] [&quot;apos&quot; #&quot;'&quot; &quot;27  ....  ]]
</pre>
<p>É claro que eu não poderia deixar o leitor a ver navios e ficar saber como tratar os casos onde o segundo elemento não é um caractere. Como o quarto elemento de cada linha é o código do caractere, basta percorrer todas as linhas da tabela e trocar o segundo elemento pelo caractere cujo o código está no quarto elemento. Podemos aproveitar e converter o quarto elemento de string para inteiro. O loop abaixo faz isso (O Red [] é necessário para que o pygmentize colorize o código corretamente).</p>
<pre class="code red literal-block">
<span class="name variable">Red</span> <span class="generic strong">[]</span>

<span class="name builtin">foreach</span> <span class="name variable">linha</span> <span class="name variable">tabela</span> <span class="generic strong">[</span>
    <span class="name variable">linha</span><span class="name attribute">/4:</span> <span class="keyword">to-integer</span> <span class="name variable">linha</span><span class="name attribute">/4</span>
    <span class="name variable">linha</span><span class="name attribute">/2:</span> <span class="keyword">to-char</span> <span class="name variable">linha</span><span class="name attribute">/4</span>
<span class="generic strong">]</span>
</pre>
<p>Após ler o artigo e entender as semelhanças e diferenças entre a regra para extrair os dados do texto e da página, você está apto a encarar novos desafios.</p>
</div>
</div>
<div class="section" id="conclusao">
<h1>Conclusão</h1>
<p>Podemos ver que o parser como alternativa de Red/Rebol para expressões regulares é bastante poderoso e, se possui a desvantagem de ser mais verboso, possui a vantagem de ser mais legível (se você não souber ER, é claro). Sem desmerecer as expressões regulares, a integração do <em>parse</em> com a linguagem deixa visualmente mais agradável, não parecendo uma prótese alienígena no seu código.</p>
</div>
</div>
  </section>
  <footer>
    
    <section class="author-info row">
      <div class="author-avatar col-md-2">
        
      </div>
      <div class="author-meta col-md-6">
        
        <h1 class="author-name text-primary">Guaracy Monteiro</h1>
        
        
      </div>
      
      <div class="author-contact col-md-4">
        <a href="mailto:guaracy.bm@gmail.com">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          &nbsp;Contact me
        </a>
      </div>
      
    </section>
    <ul class="pager">
      
      <li class="previous"><a href="https://guaracy.github.io/post/gerenciando-blog-estatico/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
      
      <li class="next disabled"><a href="#">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
    </ul>
  </footer>
</article>

  </main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
      
    </div>
    <div class="sns-links hidden-print">
  
  <a href="mailto:guaracy.bm@gmail.com">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/guaracybm" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  <a href="https://facebook.com/guaracybm" target="_blank">
    <i class="fa fa-facebook"></i>
  </a>
  
  
  <a href="https://github.com/guaracy" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
</div>

  </footer>

  <script src="https://guaracy.github.io/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  
</body>
</html>

